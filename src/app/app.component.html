<header class="modern-navbar">
  <div class="navbar-container">
    <!-- Brand -->
    <div class="brand-section">
      <a routerLink="/home" class="brand-link">
        <div class="brand-icon">
          <lucide-icon name="home" size="24"></lucide-icon>
        </div>
        <span class="brand-text">حراج بلس</span>
      </a>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-box">
        <input type="text" placeholder="ابحث في الإعلانات..." class="search-input" [(ngModel)]="searchQuery" (keyup.enter)="onSearch()">
        <button type="button" class="search-btn" (click)="onSearch()">
          <lucide-icon name="search" size="18"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Navigation Links -->
    <nav class="nav-section">
      <a class="nav-link" routerLink="/home" routerLinkActive="active">
        <lucide-icon name="home" size="18"></lucide-icon>
        الرئيسية
      </a>
      <a class="nav-link" routerLink="/ads" routerLinkActive="active">
        <lucide-icon name="trending-up" size="18"></lucide-icon>
        الإعلانات
      </a>
    </nav>

    <!-- Actions Section -->
    <div class="actions-section">
      <!-- Messages -->
      <div class="action-item" routerLink="/direct-chat" *ngIf="storage?.accessToken">
        <lucide-icon name="message-circle" size="20"></lucide-icon>
        <span class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </div>
      
      <!-- Notifications -->
      <div class="action-item" routerLink="/notifications" *ngIf="storage?.accessToken">
        <lucide-icon name="bell" size="20"></lucide-icon>
        <span class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </div>

      <!-- User Menu -->
      <div class="user-menu" *ngIf="storage?.accessToken">
        <div class="user-greeting-container">
          <div class="user-greeting-badge" [title]="greeting">
            <span class="greeting-text">{{ isAdmin ? 'Welcome admin' : (currentUser?.userName || currentUser?.fullName || currentUser?.email) }}</span>
          </div>
          <div class="user-avatar" (click)="toggleUserMenu()">
            <div class="avatar-circle">
              <ng-container *ngIf="!isAdmin && avatarUrl && !imageLoadFailed; else avatarInitial">
                <img [src]="avatarUrl" alt="profile" (error)="imageLoadFailed = true" />
              </ng-container>
              <ng-template #avatarInitial>
                {{ isAdmin ? 'A' : (currentUser?.name?.slice(0,1) || currentUser?.userName?.slice(0,1) || currentUser?.fullName?.slice(0,1) || currentUser?.email?.slice(0,1) || 'U') }}
              </ng-template>
            </div>
          </div>
        </div>
        <div class="user-dropdown" *ngIf="showUserMenu">
          <a routerLink="/profile" class="dropdown-item" *ngIf="!isAdmin">
            <lucide-icon name="user" size="16"></lucide-icon>
            الملف الشخصي
          </a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout" (click)="logout()">
            <lucide-icon name="log-out" size="16"></lucide-icon>
            تسجيل الخروج
          </button>
        </div>
      </div>

      <!-- Guest Actions -->
      <div class="guest-actions" *ngIf="!storage?.accessToken">
        <a routerLink="/auth/login" class="btn-login">
          تسجيل الدخول
        </a>
        <a routerLink="/auth/register" class="btn-register">
          إنشاء حساب
        </a>
      </div>

      <!-- Language Toggle -->
      <button type="button" class="lang-toggle" (click)="toggleLang()">
        <lucide-icon name="globe" size="18"></lucide-icon>
        {{ langLabel }}
      </button>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-toggle" (click)="toggleMenu()" [attr.aria-expanded]="mobileOpen">
      <lucide-icon name="menu" size="24"></lucide-icon>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" *ngIf="mobileOpen">
    <div class="mobile-nav">
      <a class="mobile-nav-link" routerLink="/home" (click)="closeMenu()">
        <lucide-icon name="home" size="18"></lucide-icon>
        الرئيسية
      </a>
      <a class="mobile-nav-link" routerLink="/ads" (click)="closeMenu()">
        <lucide-icon name="trending-up" size="18"></lucide-icon>
        الإعلانات
      </a>
      <a class="mobile-nav-link" routerLink="/direct-chat" (click)="closeMenu()" *ngIf="storage?.accessToken">
        <lucide-icon name="message-circle" size="18"></lucide-icon>
        الرسائل
      </a>
    </div>
  </div>
</header>

<main class="app-main container py-4">
  <router-outlet></router-outlet>
<app-notification></app-notification>
</main>

<footer class="app-footer py-3 mt-auto">
  <div class="container text-center text-muted">
    © {{ currentYear }} AdFront
  </div>
</footer>
