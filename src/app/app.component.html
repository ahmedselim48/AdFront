<header class="app-header">
  <div class="container header-inner">
    <a routerLink="/home" class="brand" aria-label="AdWise home">AdWise</a>
    <button class="menu-toggle focus-ring" (click)="toggleMenu()" [attr.aria-expanded]="mobileOpen" aria-label="Toggle menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>
    <nav class="nav-links" [class.open]="mobileOpen" (click)="closeMenu()">
      <!-- Main: فقط الإعلانات -->
      <a routerLink="/ads" routerLinkActive="active" aria-label="Ads" *ngIf="storage?.accessToken">
        <i class="icon">📢</i>
        {{ 'nav.ads' | t }}
      </a>

      <!-- قائمة منسدلة باسم المستخدم لباقي الروابط -->
      <div class="user-dropdown" *ngIf="storage?.accessToken" (click)="$event.stopPropagation()">
        <button type="button" class="user-trigger" (click)="toggleDropdown()" [attr.aria-expanded]="dropdownOpen">
          <div class="user-avatar">{{ currentUser?.name?.slice(0,1) || 'U' }}</div>
          <span class="user-trigger-name">{{ currentUser?.name || 'User' }}</span>
          <span class="chevron">▾</span>
        </button>
        <div class="dropdown-menu" *ngIf="dropdownOpen">
          <a routerLink="/dashboard" (click)="closeDropdown()">
            <span class="icon">📊</span>
            {{ 'nav.dashboard' | t }}
          </a>
          <a routerLink="/smart-replies" (click)="closeDropdown()">
            <span class="icon">🤖</span>
            {{ 'nav.smartReplies' | t }}
          </a>
          <a routerLink="/chat" (click)="closeDropdown()" class="chat-link">
            <span class="icon">💬</span>
            {{ 'nav.chat' | t }}
            <span class="badge" *ngIf="unreadCount>0">{{ unreadCount }}</span>
          </a>
          <a routerLink="/direct-chat" (click)="closeDropdown()">
            <span class="icon">👥</span>
            {{ 'nav.directChat' | t }}
          </a>
          <a routerLink="/admin" (click)="closeDropdown()">
            <span class="icon">⚙️</span>
            {{ 'nav.admin' | t }}
          </a>
          <a routerLink="/profile" (click)="closeDropdown()">
            <span class="icon">👤</span>
            {{ 'nav.profile' | t }}
          </a>
          <button type="button" class="dropdown-item danger" (click)="logout(); closeDropdown()">
            <span class="icon">🚪</span>
            {{ 'auth.logout' | t }}
          </button>
        </div>
      </div>
      
      <!-- Guest Section -->
      <div class="guest-section" *ngIf="!storage?.accessToken">
        <a routerLink="/auth/login" routerLinkActive="active" class="button primary" aria-label="Login">
          <i class="icon">🔑</i>
          {{ 'auth.login' | t }}
        </a>
        <a routerLink="/auth/register" routerLinkActive="active" class="button secondary" aria-label="Register">
          <i class="icon">📝</i>
          {{ 'auth.register' | t }}
        </a>
      </div>
      
      <!-- Language Toggle -->
      <button type="button" class="button ghost focus-ring" (click)="toggleLang()" aria-label="Change language">
        <i class="icon">🌐</i>
        {{ langLabel }}
      </button>
    </nav>
  </div>
</header>
<main class="app-main">
  <router-outlet></router-outlet>
</main>
<app-toast-center></app-toast-center>
<footer class="app-footer">
  <div class="footer-content">© {{ currentYear }} AdWise</div>
</footer>
