<div class="layout-container">
  <!-- Top Navigation -->
  <mat-toolbar color="primary" class="main-toolbar">
    <div class="toolbar-content">
      <!-- Mobile Menu Button -->
      <button 
        mat-icon-button 
        class="d-md-none"
        (click)="toggleSidenav()"
        aria-label="فتح القائمة">
        <lucide-icon name="menu" size="24"></lucide-icon>
      </button>

      <!-- Logo -->
      <div class="logo-container">
        <a routerLink="/" class="logo-link">
          <img src="assets/logo.png" alt="HarajPlus" class="logo" *ngIf="logoUrl; else textLogo">
          <ng-template #textLogo>
            <span class="logo-text">HarajPlus</span>
          </ng-template>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav d-none d-md-flex">
        <a mat-button routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <lucide-icon name="home" size="18" class="me-1"></lucide-icon>
          الرئيسية
        </a>
        <a mat-button routerLink="/ads" routerLinkActive="active">
          <lucide-icon name="grid" size="18" class="me-1"></lucide-icon>
          الإعلانات
        </a>
        <a mat-button routerLink="/categories" routerLinkActive="active">
          <lucide-icon name="tag" size="18" class="me-1"></lucide-icon>
          الفئات
        </a>
        <a mat-button routerLink="/competition" routerLinkActive="active">
          <lucide-icon name="trending-up" size="18" class="me-1"></lucide-icon>
          تحليل المنافسة
        </a>
      </nav>

      <!-- Right Side Actions -->
      <div class="toolbar-actions">
        <!-- Search -->
        <button mat-icon-button (click)="toggleSearch()" class="d-none d-md-block">
          <lucide-icon name="search" size="20"></lucide-icon>
        </button>

        <!-- Notifications -->
        <button 
          mat-icon-button 
          [matMenuTriggerFor]="notificationsMenu"
          class="notification-button">
          <lucide-icon name="bell" size="20"></lucide-icon>
          <span class="notification-badge" *ngIf="unreadNotifications > 0">
            {{ unreadNotifications }}
          </span>
        </button>

        <!-- User Menu -->
        <button 
          mat-icon-button 
          [matMenuTriggerFor]="userMenu"
          class="user-button">
          <img 
            *ngIf="userProfile?.profilePicture" 
            [src]="userProfile.profilePicture" 
            [alt]="userProfile.fullName"
            class="user-avatar">
          <lucide-icon 
            *ngIf="!userProfile?.profilePicture" 
            name="user" 
            size="20">
          </lucide-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>

  <!-- Search Bar (Desktop) -->
  <div class="search-bar" *ngIf="showSearch" [@slideDown]>
    <div class="container">
      <app-search
        [placeholder]="'البحث في الإعلانات...'"
        [showAdvancedToggle]="true"
        [showCategoryFilter]="true"
        [showPriceFilter]="true"
        [showLocationFilter]="true"
        [showStatusFilter]="true"
        [showSortFilter]="true"
        [categories]="categories"
        (search)="onSearch($event)"
        (advancedSearch)="onAdvancedSearch($event)">
      </app-search>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Side Navigation (Mobile) -->
    <mat-sidenav-container class="sidenav-container">
      <mat-sidenav 
        #sidenav 
        mode="over" 
        position="start"
        class="mobile-sidenav">
        <mat-nav-list>
          <a mat-list-item routerLink="/" (click)="closeSidenav()">
            <lucide-icon name="home" size="18" class="me-2"></lucide-icon>
            الرئيسية
          </a>
          <a mat-list-item routerLink="/ads" (click)="closeSidenav()">
            <lucide-icon name="grid" size="18" class="me-2"></lucide-icon>
            الإعلانات
          </a>
          <a mat-list-item routerLink="/categories" (click)="closeSidenav()">
            <lucide-icon name="tag" size="18" class="me-2"></lucide-icon>
            الفئات
          </a>
          <a mat-list-item routerLink="/competition" (click)="closeSidenav()">
            <lucide-icon name="trending-up" size="18" class="me-2"></lucide-icon>
            تحليل المنافسة
          </a>
          <mat-divider></mat-divider>
          <a mat-list-item routerLink="/profile" (click)="closeSidenav()">
            <lucide-icon name="user" size="18" class="me-2"></lucide-icon>
            الملف الشخصي
          </a>
          <a mat-list-item routerLink="/settings" (click)="closeSidenav()">
            <lucide-icon name="settings" size="18" class="me-2"></lucide-icon>
            الإعدادات
          </a>
          <a mat-list-item (click)="logout()">
            <lucide-icon name="log-out" size="18" class="me-2"></lucide-icon>
            تسجيل الخروج
          </a>
        </mat-nav-list>
      </mat-sidenav>

      <!-- Main Content Area -->
      <mat-sidenav-content>
        <div class="content-wrapper">
          <router-outlet></router-outlet>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5>HarajPlus</h5>
          <p class="text-muted">منصة الإعلانات الذكية مع تحليل المنافسة والذكاء الاصطناعي</p>
        </div>
        <div class="col-md-2">
          <h6>روابط سريعة</h6>
          <ul class="list-unstyled">
            <li><a routerLink="/ads">الإعلانات</a></li>
            <li><a routerLink="/categories">الفئات</a></li>
            <li><a routerLink="/competition">تحليل المنافسة</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h6>المساعدة</h6>
          <ul class="list-unstyled">
            <li><a routerLink="/help">مركز المساعدة</a></li>
            <li><a routerLink="/contact">اتصل بنا</a></li>
            <li><a routerLink="/privacy">سياسة الخصوصية</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h6>تابعنا</h6>
          <div class="social-links">
            <a href="#" class="social-link">
              <lucide-icon name="twitter" size="20"></lucide-icon>
            </a>
            <a href="#" class="social-link">
              <lucide-icon name="facebook" size="20"></lucide-icon>
            </a>
            <a href="#" class="social-link">
              <lucide-icon name="instagram" size="20"></lucide-icon>
            </a>
          </div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-12 text-center">
          <p class="text-muted mb-0">
            © {{ currentYear }} HarajPlus. جميع الحقوق محفوظة.
          </p>
        </div>
      </div>
    </div>
  </footer>
</div>

<!-- Notifications Menu -->
<mat-menu #notificationsMenu="matMenu" class="notifications-menu">
  <div class="notifications-header">
    <h6>الإشعارات</h6>
    <button mat-button (click)="markAllAsRead()" *ngIf="unreadNotifications > 0">
      تعيين الكل كمقروء
    </button>
  </div>
  <mat-divider></mat-divider>
  <div class="notifications-list">
    <div class="notification-item" *ngFor="let notification of recentNotifications">
      <div class="notification-content">
        <h6 class="notification-title">{{ notification.title }}</h6>
        <p class="notification-message">{{ notification.message }}</p>
        <small class="notification-time">{{ notification.createdAt | timeAgo }}</small>
      </div>
      <div class="notification-actions">
        <button mat-icon-button (click)="markAsRead(notification.id)">
          <lucide-icon name="check" size="16"></lucide-icon>
        </button>
      </div>
    </div>
    <div class="no-notifications" *ngIf="recentNotifications.length === 0">
      <p class="text-muted">لا توجد إشعارات جديدة</p>
    </div>
  </div>
  <mat-divider></mat-divider>
  <div class="notifications-footer">
    <button mat-button routerLink="/notifications">عرض جميع الإشعارات</button>
  </div>
</mat-menu>

<!-- User Menu -->
<mat-menu #userMenu="matMenu" class="user-menu">
  <div class="user-menu-header">
    <div class="user-info">
      <img 
        *ngIf="userProfile?.profilePicture" 
        [src]="userProfile.profilePicture" 
        [alt]="userProfile.fullName"
        class="user-avatar-small">
      <div class="user-details">
        <h6 class="user-name">{{ userProfile?.fullName || 'المستخدم' }}</h6>
        <small class="user-email">{{ userProfile?.email }}</small>
      </div>
    </div>
  </div>
  <mat-divider></mat-divider>
  <button mat-menu-item routerLink="/profile">
    <lucide-icon name="user" size="18" class="me-2"></lucide-icon>
    الملف الشخصي
  </button>
  <button mat-menu-item routerLink="/settings">
    <lucide-icon name="settings" size="18" class="me-2"></lucide-icon>
    الإعدادات
  </button>
  <button mat-menu-item routerLink="/dashboard">
    <lucide-icon name="bar-chart-3" size="18" class="me-2"></lucide-icon>
    لوحة التحكم
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="logout()">
    <lucide-icon name="log-out" size="18" class="me-2"></lucide-icon>
    تسجيل الخروج
  </button>
</mat-menu>
