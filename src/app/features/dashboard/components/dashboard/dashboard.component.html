<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">{{ getGreeting() }}، {{ currentUser?.fullName || 'مستخدم' }}</h1>
        <p class="page-subtitle">مرحباً بك في لوحة التحكم</p>
      </div>
      <div class="header-actions">
        <button mat-stroked-button (click)="onRefresh()" [disabled]="isLoading">
          <lucide-icon name="refresh-cw" size="18" class="me-2"></lucide-icon>
          تحديث
        </button>
        <button mat-raised-button color="primary" routerLink="/ads/create">
          <lucide-icon name="plus" size="18" class="me-2"></lucide-icon>
          إعلان جديد
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <app-loading-spinner [text]="'جاري تحميل لوحة التحكم...'"></app-loading-spinner>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading" class="dashboard-content">
    <!-- Stats Overview -->
    <div class="stats-section">
      <app-stats-overview 
        [totalAds]="userDashboard?.totalAds || 0"
        [publishedAds]="userDashboard?.publishedAds || 0"
        [draftAds]="userDashboard?.draftAds || 0"
        [pendingAds]="userDashboard?.pendingAds || 0"
        [totalViews]="userDashboard?.totalViews || 0"
        [totalClicks]="userDashboard?.totalClicks || 0"
        [totalLikes]="userDashboard?.totalLikes || 0">
      </app-stats-overview>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content">
      <div class="content-grid">
        <!-- Left Column -->
        <div class="left-column">
          <!-- Performance Chart -->
          <div class="chart-section">
            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>أداء الإعلانات</mat-card-title>
                <mat-card-subtitle>إحصائيات المشاهدات والإعجابات</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <app-performance-chart [recentAds]="recentAds"></app-performance-chart>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Recent Activity -->
          <div class="activity-section">
            <mat-card class="activity-card">
              <mat-card-header>
                <mat-card-title>النشاط الأخير</mat-card-title>
                <mat-card-subtitle>آخر الإعلانات والأنشطة</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <app-recent-activity [recentAds]="recentAds"></app-recent-activity>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
          <!-- Quick Actions -->
          <div class="actions-section">
            <mat-card class="actions-card">
              <mat-card-header>
                <mat-card-title>إجراءات سريعة</mat-card-title>
                <mat-card-subtitle>الوصول السريع للميزات المهمة</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <app-quick-actions (actionClick)="onQuickAction($event)"></app-quick-actions>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Subscription Status -->
          <div class="subscription-section" *ngIf="subscriptionStatus">
            <mat-card class="subscription-card">
              <mat-card-header>
                <mat-card-title>حالة الاشتراك</mat-card-title>
                <mat-card-subtitle>معلومات اشتراكك الحالي</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <app-subscription-status [subscriptionStatus]="subscriptionStatus"></app-subscription-status>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Notifications Widget -->
          <div class="notifications-section">
            <mat-card class="notifications-card">
              <mat-card-header>
                <mat-card-title>الإشعارات</mat-card-title>
                <mat-card-subtitle>آخر الإشعارات والتنبيهات</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <app-notifications-widget 
                  [notifications]="notifications"
                  [isLoading]="isLoadingNotifications">
                </app-notifications-widget>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Stats -->
    <div class="additional-stats">
      <div class="stats-grid">
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <lucide-icon name="eye" size="24"></lucide-icon>
              </div>
              <div class="stat-info">
                <h3>{{ getTotalViews() | number }}</h3>
                <p>إجمالي المشاهدات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <lucide-icon name="heart" size="24"></lucide-icon>
              </div>
              <div class="stat-info">
                <h3>{{ getTotalLikes() | number }}</h3>
                <p>إجمالي الإعجابات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <lucide-icon name="message-square" size="24"></lucide-icon>
              </div>
              <div class="stat-info">
                <h3>{{ getTotalComments() | number }}</h3>
                <p>إجمالي التعليقات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <lucide-icon name="trending-up" size="24"></lucide-icon>
              </div>
              <div class="stat-info">
                <h3>{{ userDashboard?.totalClicks || 0 | number }}</h3>
                <p>إجمالي النقرات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
