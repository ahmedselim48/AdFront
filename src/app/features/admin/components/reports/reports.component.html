<!-- التقارير والإحصائيات -->
<div class="reports-container" dir="rtl">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>assessment</mat-icon>
        التقارير والإحصائيات
      </h1>
      <div class="header-actions">
        <div class="action-group">
          <button mat-raised-button color="accent" (click)="exportReport('pdf')" class="action-btn export-pdf-btn">
            <mat-icon>picture_as_pdf</mat-icon>
            <span>تصدير PDF</span>
          </button>
          <button mat-raised-button color="primary" (click)="exportReport('excel')" class="action-btn export-excel-btn">
            <mat-icon>table_chart</mat-icon>
            <span>تصدير Excel</span>
          </button>
        </div>
        <div class="action-group">
          <button mat-raised-button color="warn" (click)="printUsersReport()" [disabled]="loading" class="print-btn">
            <mat-icon>print</mat-icon>
            <span>طباعة المستخدمين</span>
          </button>
          <button mat-raised-button color="warn" (click)="printAdsReport()" [disabled]="loading" class="print-btn">
            <mat-icon>print</mat-icon>
            <span>طباعة الإعلانات</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-row">
        <!-- أزلنا اختيار الفترة وأبقينا على النطاق المخصص فقط -->

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>من تاريخ</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="selectedDateRange.start">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>إلى تاريخ</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="selectedDateRange.end">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="onDateRangeChange()">
          <mat-icon>filter_list</mat-icon>
          تطبيق الفلتر
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card users-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>people</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ formatNumber(stats.totalUsers) }}</h3>
            <p>إجمالي المستخدمين</p>
            <div class="growth-indicator">
              <mat-icon [class]="getGrowthColor(stats.userGrowth)">{{ getGrowthIcon(stats.userGrowth) }}</mat-icon>
              <span [class]="getGrowthColor(stats.userGrowth)">
                {{ stats.userGrowth >= 0 ? '+' : '' }}{{ stats.userGrowth }}%
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card ads-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>campaign</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ formatNumber(stats.totalAds) }}</h3>
            <p>إجمالي الإعلانات</p>
            <div class="growth-indicator">
              <mat-icon [class]="getGrowthColor(stats.adGrowth)">{{ getGrowthIcon(stats.adGrowth) }}</mat-icon>
              <span [class]="getGrowthColor(stats.adGrowth)">
                {{ stats.adGrowth >= 0 ? '+' : '' }}{{ stats.adGrowth }}%
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card views-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>visibility</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ formatNumber(stats.totalViews) }}</h3>
            <p>إجمالي المشاهدات</p>
            <div class="growth-indicator">
              <mat-icon [class]="getGrowthColor(stats.viewGrowth)">{{ getGrowthIcon(stats.viewGrowth) }}</mat-icon>
              <span [class]="getGrowthColor(stats.viewGrowth)">
                {{ stats.viewGrowth >= 0 ? '+' : '' }}{{ stats.viewGrowth }}%
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card revenue-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ formatCurrency(stats.totalRevenue) }}</h3>
            <p>إجمالي الإيرادات</p>
            <div class="growth-indicator">
              <mat-icon [class]="getGrowthColor(stats.revenueGrowth)">{{ getGrowthIcon(stats.revenueGrowth) }}</mat-icon>
              <span [class]="getGrowthColor(stats.revenueGrowth)">
                {{ stats.revenueGrowth >= 0 ? '+' : '' }}{{ stats.revenueGrowth }}%
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  

  <!-- Summary Table -->
  <mat-card class="summary-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>table_chart</mat-icon>
        ملخص الإحصائيات
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="summary-table">
        <div class="table-header">
          <div class="header-cell">المؤشر</div>
          <div class="header-cell">القيمة الحالية</div>
          <div class="header-cell">النمو</div>
          <div class="header-cell">التوقعات</div>
        </div>
        <div class="table-row">
          <div class="table-cell">المستخدمين</div>
          <div class="table-cell">{{ formatNumber(stats.totalUsers) }}</div>
          <div class="table-cell">
            <mat-chip [color]="getGrowthColor(stats.userGrowth)">
              {{ stats.userGrowth >= 0 ? '+' : '' }}{{ stats.userGrowth }}%
            </mat-chip>
          </div>
          <div class="table-cell">{{ formatNumber(stats.totalUsers * 1.1) }}</div>
        </div>
        <div class="table-row">
          <div class="table-cell">الإعلانات</div>
          <div class="table-cell">{{ formatNumber(stats.totalAds) }}</div>
          <div class="table-cell">
            <mat-chip [color]="getGrowthColor(stats.adGrowth)">
              {{ stats.adGrowth >= 0 ? '+' : '' }}{{ stats.adGrowth }}%
            </mat-chip>
          </div>
          <div class="table-cell">{{ formatNumber(stats.totalAds * 1.15) }}</div>
        </div>
        <div class="table-row">
          <div class="table-cell">المشاهدات</div>
          <div class="table-cell">{{ formatNumber(stats.totalViews) }}</div>
          <div class="table-cell">
            <mat-chip [color]="getGrowthColor(stats.viewGrowth)">
              {{ stats.viewGrowth >= 0 ? '+' : '' }}{{ stats.viewGrowth }}%
            </mat-chip>
          </div>
          <div class="table-cell">{{ formatNumber(stats.totalViews * 1.2) }}</div>
        </div>
        <div class="table-row">
          <div class="table-cell">الإيرادات</div>
          <div class="table-cell">{{ formatCurrency(stats.totalRevenue) }}</div>
          <div class="table-cell">
            <mat-chip [color]="getGrowthColor(stats.revenueGrowth)">
              {{ stats.revenueGrowth >= 0 ? '+' : '' }}{{ stats.revenueGrowth }}%
            </mat-chip>
          </div>
          <div class="table-cell">{{ formatCurrency(stats.totalRevenue * 1.25) }}</div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
