<div class="ad-edit-container">
  <div class="ad-edit-header">
    <h1>ุชุนุฏูู ุงูุฅุนูุงู</h1>
    <p>ูู ุจุชุญุฏูุซ ุชูุงุตูู ุฅุนูุงูู</p>
  </div>

  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>ุฌุงุฑู ุชุญููู ุงูุฅุนูุงู...</p>
  </div>

  <form [formGroup]="form" (ngSubmit)="save()" class="ad-form" *ngIf="!loading && ad">
    <div class="form-grid">
      <!-- Basic Information -->
      <div class="form-section">
        <h3>ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h3>
        
        <!-- Title -->
        <div class="form-field">
          <label class="form-label">ุนููุงู ุงูุฅุนูุงู *</label>
          <input 
            type="text" 
            formControlName="title" 
            placeholder="ุงูุชุจ ุนููุงู ุฌุฐุงุจ ูุฅุนูุงูู"
            class="form-input"
            maxlength="200">
          <div class="char-count">{{ form.get('title')?.value?.length || 0 }}/200</div>
          <div class="error-message" *ngIf="form.get('title')?.invalid && form.get('title')?.touched">
            ุงูุนููุงู ูุทููุจ (ุงูุญุฏ ุงูุฃูุตู 200 ุญุฑู)
          </div>
        </div>

        <!-- Description -->
        <div class="form-field">
          <label class="form-label">ูุตู ุงูุฅุนูุงู *</label>
          <textarea 
            formControlName="description" 
            placeholder="ุงูุชุจ ูุตูุงู ููุตูุงู ุนู ููุชุฌู ุฃู ุฎุฏูุชู"
            class="form-textarea"
            rows="4"
            maxlength="5000">
          </textarea>
          <div class="char-count">{{ form.get('description')?.value?.length || 0 }}/5000</div>
          <div class="error-message" *ngIf="form.get('description')?.invalid && form.get('description')?.touched">
            ุงููุตู ูุทููุจ (ุงูุญุฏ ุงูุฃูุตู 5000 ุญุฑู)
          </div>
        </div>

        <!-- Price and Location -->
        <div class="form-row">
          <div class="form-field half-width">
            <label class="form-label">ุงูุณุนุฑ (ุฑูุงู ุณุนูุฏู) *</label>
            <input 
              type="number" 
              formControlName="price" 
              placeholder="0.00"
              class="form-input"
              min="0">
            <div class="error-message" *ngIf="form.get('price')?.invalid && form.get('price')?.touched">
              ุงูุณุนุฑ ูุทููุจ ููุฌุจ ุฃู ูููู ุฃูุจุฑ ูู ุฃู ูุณุงูู ุตูุฑ
            </div>
          </div>

          <div class="form-field half-width">
            <label class="form-label">ุงููููุน *</label>
            <input 
              type="text" 
              formControlName="location" 
              placeholder="ูุซุงู: ุงูุฑูุงุถุ ุฌุฏุฉ"
              class="form-input"
              maxlength="200">
            <div class="error-message" *ngIf="form.get('location')?.invalid && form.get('location')?.touched">
              ุงููููุน ูุทููุจ (ุงูุญุฏ ุงูุฃูุตู 200 ุญุฑู)
            </div>
          </div>
        </div>

        <!-- Category -->
        <div class="form-field">
          <label class="form-label">ุงููุฆุฉ *</label>
          <select formControlName="categoryId" class="form-select">
            <option value="">ุงุฎุชุฑ ุงููุฆุฉ</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
          <div class="error-message" *ngIf="form.get('categoryId')?.invalid && form.get('categoryId')?.touched">
            ุงููุฆุฉ ูุทููุจุฉ
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div class="form-section">
        <h3>ูุนูููุงุช ุงูุชูุงุตู</h3>
        
        <div class="form-row">
          <div class="form-field half-width">
            <label class="form-label">ุฑูู ุงูุชูุงุตู *</label>
            <input 
              type="text" 
              formControlName="contactNumber" 
              placeholder="ูุซุงู: 0501234567"
              class="form-input"
              maxlength="15">
            <div class="error-message" *ngIf="form.get('contactNumber')?.invalid && form.get('contactNumber')?.touched">
              ุฑูู ุงูุชูุงุตู ูุทููุจ (ุงูุญุฏ ุงูุฃุฏูู 10 ุฃุฑูุงู)
            </div>
          </div>

          <div class="form-field half-width">
            <label class="form-label">ุทุฑููุฉ ุงูุชูุงุตู *</label>
            <select formControlName="contactMethod" class="form-select">
              <option value="Call">ุงุชุตุงู</option>
              <option value="WhatsApp">ูุงุชุณุงุจ</option>
            </select>
            <div class="error-message" *ngIf="form.get('contactMethod')?.invalid && form.get('contactMethod')?.touched">
              ุทุฑููุฉ ุงูุชูุงุตู ูุทููุจุฉ
            </div>
          </div>
        </div>
      </div>

      <!-- Images Section -->
      <div class="form-section">
        <h3>ุงูุตูุฑ</h3>
        
        <!-- Current Images -->
        <div class="current-images" *ngIf="ad.images && ad.images.length > 0">
          <h4>ุงูุตูุฑ ุงูุญุงููุฉ</h4>
          <div class="image-grid">
            <div class="image-item" *ngFor="let image of ad.images; let i = index">
              <img [src]="image" [alt]="ad.title">
              <button 
                type="button" 
                class="remove-btn" 
                (click)="removeImage(i)">
                ร
              </button>
            </div>
          </div>
        </div>
        
        <!-- File Upload -->
        <div class="file-upload-area">
          <input 
            type="file" 
            id="fileInput" 
            (change)="onFileSelected($event)" 
            multiple 
            accept="image/*"
            class="file-input">
          <label for="fileInput" class="file-upload-label">
            <span class="upload-icon">๐</span>
            <span>ุงุฎุชุฑ ุตูุฑ ุฌุฏูุฏุฉ (ุงูุญุฏ ุงูุฃูุตู 12 ุตูุฑุฉ)</span>
            <small>JPG, PNG, WEBP, GIF - ุงูุญุฏ ุงูุฃูุตู 10MB ููู ุตูุฑุฉ</small>
          </label>
        </div>

        <!-- New Image Previews -->
        <div class="image-previews" *ngIf="previewUrls.length > 0">
          <h4>ุงูุตูุฑ ุงูุฌุฏูุฏุฉ</h4>
          <div class="image-grid">
            <div class="image-preview" *ngFor="let url of previewUrls; let i = index">
              <img [src]="url" alt="Preview">
              <button 
                type="button" 
                class="remove-btn" 
                (click)="removeImage(i)">
                ร
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Keywords Section -->
      <div class="form-section">
        <h3>ุงููููุงุช ุงูููุชุงุญูุฉ</h3>
        
        <div class="keywords-input">
          <input 
            type="text" 
            #keywordInput
            placeholder="ุฃุถู ูููุฉ ููุชุงุญูุฉ ูุงุถุบุท Enter"
            (keydown.enter)="addKeyword(keywordInput.value); keywordInput.value = ''"
            class="keyword-input">
          <button 
            type="button" 
            (click)="addKeyword(keywordInput.value); keywordInput.value = ''"
            class="add-keyword-btn">
            ุฅุถุงูุฉ
          </button>
        </div>

        <div class="keywords-list" *ngIf="form.get('keywords')?.value?.length > 0">
          <span 
            *ngFor="let keyword of form.get('keywords')?.value" 
            class="keyword-tag">
            {{ keyword }}
            <button 
              type="button" 
              (click)="removeKeyword(keyword)"
              class="remove-keyword">
              ร
            </button>
          </span>
        </div>
      </div>

      <!-- Publishing Options -->
      <div class="form-section">
        <h3>ุฎูุงุฑุงุช ุงููุดุฑ</h3>
        
        <div class="form-row">
          <div class="form-field half-width">
            <label class="form-label">ุญุงูุฉ ุงูุฅุนูุงู</label>
            <select formControlName="status" class="form-select">
              <option value="Draft">ูุณูุฏุฉ</option>
              <option value="Published">ููุดูุฑ</option>
            </select>
          </div>

          <div class="form-field half-width">
            <label class="form-label">ุฌุฏููุฉ ุงููุดุฑ (ุงุฎุชูุงุฑู)</label>
            <input 
              type="datetime-local" 
              formControlName="scheduledAt"
              class="form-input">
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button 
        type="button" 
        (click)="cancel()" 
        class="btn btn-secondary">
        ุฅูุบุงุก
      </button>
      
      <button 
        type="button" 
        (click)="saveAsDraft()" 
        [disabled]="saving || form.invalid"
        class="btn btn-accent">
        <span *ngIf="saving" class="spinner-small"></span>
        <span *ngIf="!saving">ุญูุธ ููุณูุฏุฉ</span>
      </button>
      
      <button 
        type="submit" 
        [disabled]="saving || form.invalid"
        class="btn btn-primary">
        <span *ngIf="saving" class="spinner-small"></span>
        <span *ngIf="!saving">ุญูุธ ุงูุชุบููุฑุงุช</span>
      </button>
    </div>
  </form>
</div>