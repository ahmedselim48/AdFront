<div class="profile-settings">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>جاري تحميل البيانات...</p>
  </div>

  <!-- Profile Settings Content -->
  <div *ngIf="!isLoading" class="settings-content">
    <!-- Profile Image Section -->
    <mat-card class="profile-image-card">
      <mat-card-header>
        <mat-card-title>صورة الملف الشخصي</mat-card-title>
        <mat-card-subtitle>قم برفع صورة شخصية واضحة</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="image-upload-section">
          <div class="current-image">
            <img *ngIf="currentUser?.profileImageUrl && !imagePreview" 
                 [src]="getProfileImageUrl()" 
                 [alt]="currentUser?.fullName"
                 class="profile-image">
            <img *ngIf="imagePreview" 
                 [src]="imagePreview" 
                 alt="Preview"
                 class="profile-image">
            <div *ngIf="!currentUser?.profileImageUrl && !imagePreview" 
                 class="image-placeholder">
              {{ getInitials(currentUser?.fullName || 'U') }}
            </div>
          </div>
          
          <div class="image-actions">
            <input #fileInput 
                   type="file" 
                   accept="image/*" 
                   (change)="onImageSelected($event)"
                   style="display: none;">
            <button mat-raised-button 
                    color="primary" 
                    (click)="fileInput.click()"
                    [disabled]="isSaving">
              <lucide-icon name="camera" size="16"></lucide-icon>
              <span>اختر صورة</span>
            </button>
            
            <button *ngIf="imagePreview" 
                    mat-raised-button 
                    color="accent" 
                    (click)="onUploadImage()"
                    [disabled]="isSaving">
              <lucide-icon name="save" size="16"></lucide-icon>
              <span>رفع الصورة</span>
            </button>
            
            <button *ngIf="imagePreview" 
                    mat-button 
                    color="warn" 
                    (click)="onRemoveImage()"
                    [disabled]="isSaving">
              <lucide-icon name="trash-2" size="16"></lucide-icon>
              <span>إلغاء</span>
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Profile Information Form -->
    <mat-card class="profile-form-card">
      <mat-card-header>
        <mat-card-title>المعلومات الشخصية</mat-card-title>
        <mat-card-subtitle>قم بتحديث معلوماتك الشخصية</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="profileForm" (ngSubmit)="onSaveProfile()">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>الاسم الأول</mat-label>
              <input matInput 
                     formControlName="firstName"
                     placeholder="أدخل اسمك الأول">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error *ngIf="getFieldError('firstName')">
                {{ getFieldError('firstName') }}
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>الاسم الأخير</mat-label>
              <input matInput 
                     formControlName="lastName"
                     placeholder="أدخل اسمك الأخير">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error *ngIf="getFieldError('lastName')">
                {{ getFieldError('lastName') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>رقم الهاتف</mat-label>
              <input matInput 
                     formControlName="phoneNumber"
                     placeholder="أدخل رقم هاتفك">
              <mat-icon matPrefix>phone</mat-icon>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>العنوان</mat-label>
              <input matInput 
                     formControlName="address"
                     placeholder="أدخل عنوانك">
              <mat-icon matPrefix>location_on</mat-icon>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit"
                    [disabled]="profileForm.invalid || isSaving">
              <lucide-icon name="save" size="16"></lucide-icon>
              <span>حفظ التغييرات</span>
              <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Account Information -->
    <mat-card class="account-info-card" *ngIf="currentUser">
      <mat-card-header>
        <mat-card-title>معلومات الحساب</mat-card-title>
        <mat-card-subtitle>معلومات إضافية عن حسابك</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <lucide-icon name="mail" size="20"></lucide-icon>
            <div class="info-content">
              <span class="info-label">البريد الإلكتروني</span>
              <span class="info-value">{{ currentUser.email }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <lucide-icon name="user" size="20"></lucide-icon>
            <div class="info-content">
              <span class="info-label">اسم المستخدم</span>
              <span class="info-value">{{ currentUser.userName }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <lucide-icon name="calendar" size="20"></lucide-icon>
            <div class="info-content">
              <span class="info-label">تاريخ الانضمام</span>
              <span class="info-value">{{ formatDate(currentUser.createdAt) }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <lucide-icon name="shield" size="20"></lucide-icon>
            <div class="info-content">
              <span class="info-label">حالة البريد الإلكتروني</span>
              <span class="info-value" [class.confirmed]="currentUser.isEmailConfirmed">
                {{ currentUser.isEmailConfirmed ? 'مؤكد' : 'غير مؤكد' }}
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>